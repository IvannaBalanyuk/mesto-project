(()=>{"use strict";var e,t,n=document.querySelector(".page"),r="page_non-scroll",o={baseUrl:"https://nomoreparties.co/v1/plus-cohort-24",headers:{authorization:"53e7280d-81b7-4e82-b5c1-fc2456f5c412","Content-Type":"application/json"}},a="3efa99fb862700e7ea4331b9",c="Сохранить",i="Создать",s="Сохранение...",u="Удаление...",l=n.querySelector(".profile__user-name"),d=n.querySelector(".profile__user-about"),f=n.querySelector(".profile__avatar-image"),v=n.querySelector(".button-edit"),m=n.querySelector(".profile__avatar-button"),p=n.querySelector(".button-add"),h="button-like_active",y=n.querySelector(".popup_type_edit-profile"),b=n.querySelector(".popup_type_change-avatar"),_=n.querySelector(".popup_type_add-card"),S=n.querySelector(".popup_type_delete-card"),g=n.querySelector(".popup_type_show-image"),L=n.querySelector(".popup__image"),E=n.querySelector(".popup__image-caption"),q="popup_opened",C=n.querySelector(".cards__list"),k=n.querySelector(".no-cards"),A=n.querySelector("#card-template").content,x=".card",U=".card__place-name",T=document.forms.editProfile,w=document.forms.changeAvatar,j=document.forms.addCard,O=document.forms.deleteCard,D=T.elements.userName,N=T.elements.userAbout,P=w.elements.avatarLink,B=j.elements.placeName,M=j.elements.imageLink,I={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".button-save",inactiveButtonClass:"button-save_disabled",inputErrorClass:"form__input_type_error",errorActiveClass:"form__input-error_visible"},J=function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorActiveClass),r.textContent=""},G=function(e,t,n,r){t.querySelector(".button-save").value=e?n:r},H=function(e){"Escape"===e.key&&$(n.querySelector(".popup_opened"))},V=function(e){(e.target.classList.contains("popup")||e.target.classList.contains("button-close"))&&$(e.target.closest(".popup"))},z=function(e){e.classList.add(q),n.classList.add(r),n.addEventListener("keydown",H),n.addEventListener("click",V)},$=function(e){e.classList.remove(q),n.classList.remove(r),n.removeEventListener("keydown",H),n.removeEventListener("click",V)},F=function(e){return Array.from(e.querySelectorAll(I.inputSelector))},K=function(e){return e.querySelector(I.submitButtonSelector)},Q=function(e){var t=K(e);t.classList.add(I.inactiveButtonClass),t.setAttribute("disabled",!0)},R=function(e){var t=K(e);t.classList.remove(I.inactiveButtonClass),t.removeAttribute("disabled")},W=function(e){F(e).forEach((function(t){J(e,t,I)}))},X=function(e){return e.ok?e.json():Promise.reject(e.status)},Y=function(e,t){l.textContent=e,d.textContent=t},Z=function(e){f.src=e},ee=function(e){z(g);var t=e.target.closest(x).querySelector(U).textContent,n=e.target.src;L.src=n,L.alt=t,E.textContent=t},te=function(e,t,n,r,o){var c=A.querySelector(x).cloneNode(!0),i=c.querySelector(U),s=c.querySelector(".card__place-image"),u=c.querySelector(".button-like"),l=c.querySelector(".button-delete");return s.src=e,s.alt=t,i.textContent=t,c.setAttribute("data-id","".concat(n)),oe(r)&&ne(u),o!==a&&l.remove(),s.addEventListener("click",ee),re(c,r),c},ne=function(e){e.classList.toggle(h)},re=function(e,t){e.querySelector(".card__likes-counter").textContent=t.length},oe=function(e){return e.some((function(e){return e._id===a}))};function ae(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,c,i=[],s=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=a.call(n)).done)&&(i.push(r.value),i.length!==t);s=!0);}catch(e){u=!0,o=e}finally{try{if(!s&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ce(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}t=I,Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=F(e);n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?J(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorActiveClass)}(e,t,t.validationMessage,n)}(e,r,t),function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?R(t):Q(t)}(n,e)}))}))}(e,t)})),Promise.all([fetch("".concat(o.baseUrl,"/users/me"),{method:"GET",headers:o.headers}).then((function(e){return X(e)})),fetch("".concat(o.baseUrl,"/cards"),{method:"GET",headers:o.headers}).then((function(e){return X(e)}))]).then((function(e){var t=ae(e,2),n=t[0],r=t[1];Y(n.name,n.about),Z(n.avatar),r.reverse().forEach((function(e){ie(te(e.link,e.name,e._id,e.likes,e.owner._id))}))})).catch((function(e){var t=ae(e,2),n=t[0],r=t[1];console.log("Ошибка: ".concat(n)),console.log("Ошибка: ".concat(r))})),v.addEventListener("click",(function(){z(y),D.value=l.textContent,N.value=d.textContent,W(T),R(T)})),T.addEventListener("submit",(function(e){var t,n;e.preventDefault(),G(!0,T,s,c),(t=D.value,n=N.value,fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return X(e)}))).then((function(e){Y(e.name,e.about),$(y)})).catch((function(e){console.log("Ошибка: ".concat(e))})).finally((function(){G(!1,T,s,c)}))})),m.addEventListener("click",(function(){z(b),w.reset(),W(w),Q(w)})),w.addEventListener("submit",(function(e){var t;e.preventDefault(),G(!0,w,s,c),(t=P.value,fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:t})}).then((function(e){return X(e)}))).then((function(e){Z(e.avatar),$(b)})).catch((function(e){console.log("Ошибка: ".concat(e))})).finally((function(){G(!1,w,s,c)}))})),p.addEventListener("click",(function(){z(_),j.reset(),W(j),Q(j)}));var ie=function(e){C.prepend(e)};j.addEventListener("submit",(function(e){var t,n;e.preventDefault(),G(!0,j,s,i),(t=B.value,n=M.value,fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return X(e)}))).then((function(e){ie(te(e.link,e.name,e._id,e.likes,e.owner._id)),$(_)})).catch((function(e){console.log("Ошибка: ".concat(e))})).finally((function(){G(!1,j,s,i)}))})),C.addEventListener("click",(function(t){t.target.classList.contains("button-delete")&&(z(S),e=t.target.closest(x))})),O.addEventListener("submit",(function(t){var n;t.preventDefault(),G(!0,O,u,"Да"),(n=e.dataset.id,fetch("".concat(o.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:o.headers}).then((function(e){return X(e)}))).then((function(){e.remove(),C.hasChildNodes()||k.classList.remove("no-cards_hidden"),$(S)})).catch((function(e){console.log("Ошибка: ".concat(e))})).finally((function(){G(!1,O,u,"Да")}))})),C.addEventListener("click",(function(e){if(e.target.classList.contains("button-like")){var t=e.target.closest(x);e.target.classList.contains(h)?function(e){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(e,"/"),{method:"DELETE",headers:o.headers}).then((function(e){return X(e)}))}(t.dataset.id).then((function(n){ne(e.target),re(t,n.likes)})).catch((function(e){console.log("Ошибка: ".concat(e))})):(n=t.dataset.id,fetch("".concat(o.baseUrl,"/cards/likes/").concat(n,"/"),{method:"PUT",headers:o.headers}).then((function(e){return X(e)}))).then((function(n){ne(e.target),re(t,n.likes)})).catch((function(e){console.log("Ошибка: ".concat(e))}))}var n}))})();